Simple backup
=============

Tree:
=====

The installation layout should comply with the latest FHS (2.3 as of Nov 2006).
Everything different than that should be reported as bug.

${bindir}/			The vbackup program
	
${sysconfdir}/
	vbackup/
		rc.d/		Backup configurations
		backup.daily/	Links to appropriate rc.d scripts
			vbackup.conf	Per backup global configuration file
		backup.weekly/	....
		backup.monthly/	....
		

${datadir}/
	vbackup/
		bin/		Core scripts (run) used by vbackup
				(They are standalone scripts)
		helpers/	Helper scripts (not standalone)
		scripts/	The backup scripts

${docdir}/
	vbackup/		Documentation
		samples/	Sample configurations


Backup scripts:
===============

Each backup script must provide:

functions:
----------
do_help()		A function to display help and return
do_check_conf()		Check whether all configuration variables are ok
			Return: 0: OK, 1: Error
			May display error messages
do_run()		Do the backup

variables:
----------
NAME			The script name ("psql")
VERSION			The script version ("1.0.0")
DESC			A short description ("Backup a postgresql database")
COPYRIGHT		Copyright ("Copyright (c) 2006 Harhalakis Stefanos")
LICENCE			The license of the script ("GPLv2")
CONTACT			A contact email for bugreports etc ("v13@v13.gr")

It may expect:
--------------
  * If the configuration file includes a DESTDIR options, it will be
    prepended with the DESTDIR0 prefix. It will also be transformed
    by changed %X% variables (for example %D1%)
  * A variable named ABORT is set to 1 if a script previously exited with
    error code 2 (see bellow). Most scripts should abort with exit code 0
    when they detect this. For example: a script that checks for free space
    may exit with error code 2. The ABORT variable will be set automatically.
    All backup scripts must detect this and do nothing. The umount script
    will ignore this and actually try to umount the directory.

It must return (from each function):
------------------------------------
0	Everything were OK
1	Error occured - continue backups
2	Error occured - abort backup sequence
3	Error occured - force abort of backup sequence

Notes:
  * When a script returns 2, the flag ABORT is set to 1. This is
    checked by backup scripts and they will not do anything at all.
    Scripts like umount may ignore this and umount the directory
  * When a script returns 3, the backup is immediately aborted.
    This sould be used by scripts like mount

Configuration files:
====================

Some configuration files may include a DESTDIR directive.
It may contain the following special sequences:

 * '%D1%' which will be replaced by YYMMDD of the current date
   Example: /tmp/backups/filesystem/%D1%
   will be converted to: /tmp/backups/filesystem/061117 (as of 17 Nov 2006)

(to be extended with other formats)

Configuration directives:
=========================

Configuration directives should preserve the same name across scripts  when
possible. Common directives are (using regexp):

 DESTDIR	Where to backup to
 DATABASES	The databases to backup, for DB backups
 PASSWORD	To hold a password
 .*USER		To hold a username (examples: PGUSER, MYUSER etc..)
 
NOTE! The directive USER should never be used. I repeat NEVER USE THE USER
DIRECTIVE! Same thing applies for other well known directives that may be
set by sh/bash.

Common configuration variables:
===============================

Common configuration variables are variables that are set in vbackup.conf
or in other configuration files. The vbackup.conf entry is the main one
but it may be overriden by individual configuration files.

 COMPRESS	Whether to compress the backup or not (yes/no, on/off, 1/0)


